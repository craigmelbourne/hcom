<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Cors test</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>

		<style type="text/css">
			body {font-family: arial; background-color:#eee; margin:0; padding:0;}
			h1 {padding:0; margin:0;}
			ul {list-style-type: none; margin:0; padding:0;}

			#list-wrapper {position:absolute; top:0; left:0; width:200px; z-index:1;}
			#details-wrapper {position:relative; display:none; z-index:2;}

			ul#hotelList li{padding:6px;}
			ul#hotelList li:hover {cursor:pointer;}
		</style>

	</head>
	<body>

		<div style="overflow:hidden;">
			<div id="list-wrapper" style="">
				<ul id="hotelList"></ul>
			</div>

			<div id="details-wrapper">
				<div id="details">
					<div style="height:300px; background-color:#ddd;">
						<div id="close-pdp" style="padding:12px;">X</div>
						<h1></h1>
					</div>
					

				</div>
			</div>
			
		</div>

		

		
		<script>

			$(function(){
				
				fetchSearchResults("London");

				$("#hotelList").on("click", "li", function(){
					fetchHotelDetails($(this).attr("id"));
					$("#details-wrapper").show("slide", { direction: "right" }, 500);
				});

				$("#close-pdp").on("click", function(){
					$("#details-wrapper").hide("slide", { direction: "right" }, 500);
				})

			});

			function fetchSearchResults(destination) {

				var url = buildSearchUrl(destination);
				var hotels = '';

				$.getJSON(url).done(function(json){
					hotels = json.result.hotels;
					console.log (json.result.hotels[0])
					$.each( hotels, function( i, hotel ) {
  						//console.log( i + ": " + hotel.hotelName );

  						$("#hotelList").append("<li id=" + hotel.hotelId + ">" + hotel.hotelName + "</li>")
					});
				});

			};

			function fetchHotelDetails(hotelId) {

				var url = "http://localhost:8899/device/hotelDetails.html?hotelId=" + hotelId + "&na=os%3DFacebook%7Ccv%3D1171%7Csv%3D2%7Cid%3DCFUUID9BC82AC4A123485586F5F6AFEF2084E0"

				$.getJSON(url).done(function(json){
					console.log(json.result);

					$("#details h1").text(json.result.roomRates.hotelSummary.hotelName);

				});

			}


			function buildSearchUrl(destination) {
  				var url = '', 
      			//search_destination = (destination) ? destination : SearchForm.destination,
      			hostname = window.location.hostname;


  				if (hostname == 'localhost') {    
    				url = 'http://localhost:8899/device/search.html?destination='+destination+'&cur=GBP&monthCheckIn=8&dayInMonthCheckIn=31&monthCheckOut=9&dayInMonthCheckOut=1&r=1&na=os%3DFacebook%7Ccv%3D1171%7Csv%3D2%7Cid%3DCFUUID9BC82AC4A123485586F5F6AFEF2084E0';

    				//console.log(url);
  				} else {
    				url = '/api/search.html?destination='+destination+'&cur=GBP&monthCheckIn=8&dayInMonthCheckIn=31&monthCheckOut=9&dayInMonthCheckOut=1&r=1&na=os%3DFacebook%7Ccv%3D1171%7Csv%3D2%7Cid%3DCFUUID9BC82AC4A123485586F5F6AFEF2084E0';
  				}
  				return url;
			}


		</script>
	</body>
</html>