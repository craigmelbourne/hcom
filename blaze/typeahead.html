<!DOCTYPE html>
<html lang="en">
	<head>
    <link rel="stylesheet" href="blaze.css">
		<script src="../jquery.js"></script>
    <script type="text/javascript"
          src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDGbEUwknHTaKmEpjwM-fRfJt7zbCZZtCI&sensor=false">
      </script>
		<script type="text/javascript" src="typeahead.bundle.js"></script>
    <script type="text/javascript" src="blaze.js"></script>
    <script type="text/javascript" src="locations.js"></script>

		<script type="text/javascript">

    var homePageDisplayed = true;

    function displayHomePage(){
      $("#map_wrapper").hide();
      $("#hotels").hide();
      $("#navigation").hide();
      $(".filter").hide();

      $("#search").addClass("home");
      $("#search_wrapper").addClass("search_home");
    }

    function displayResultsScreen(dest){
      
      var result = $.grep(cities, function(e){
        return e.city == dest;
      });

      if (result[0].ranking == 0) {
        initializeMap(result);
        $("#map_wrapper").show();
        $("#hotels").show();
        $("#navigation").show();
        //$(".filter").show();
        $("#search").removeClass("home");
        $("#strapline").hide();
        $("#search_wrapper").removeClass("search_home").addClass("search_results");
        homePageDisplayed = false;
      } 

      
    }

    function displayFilters(val) {
      if (val == true) {
        $(".typeahead").animate({
          width: "200px"
        }, 200).blur();
        $(".filter").show();
      } else {
        $(".filter").hide();
      }

    }

    function displaySearchInstruction(val){
      
      if(val == true) {
        var ddpos = $(".tt-dropdown-menu").offset();
        var ddheight = $(".tt-dropdown-menu").height();
        console.log ("top = " + ddpos.top + ", height = " + ddheight)
        $("#searchinstruction").show().css({
            "top": ddpos.top + ddheight + 10 + "px"
          });
      } else {
        $("#searchinstruction").hide();
      }
      
    }

    function handleResults(dest){
      

       if (dest != currentdestination){

          var result = $.grep(cities, function(e){
            return e.city == dest;
          });

          if(result.length != 0){
            if (result[0].ranking == 0){
              displaySearchInstruction(false);

              var loc = new google.maps.LatLng(result[0].lon, result[0].lat);
              map.panTo(loc);
            

              if ($("#srl").is(':visible')){
                $("#srl").fadeOut("100", function(){
                  $("#srl").fadeIn("100");
                });

              } else {
                $("#srl").fadeIn("100");
              }

              $("#map_wrapper").show();
            
            } else if(result[0].ranking == 1)  {
            
              if ($("#srl").is(':visible')){
                $("#srl").hide();
                $("#map_wrapper").hide();
                displaySearchInstruction(true);
              }
            
            }
          } else {
            console.log("in here");
            displaySearchInstruction(false);
            if ($("#srl").is(':visible')){
              $("#srl").hide();
              $("#map_wrapper").hide();
            }
          }


           
          currentdestination = dest;

          
        }

    }
      
 //else {
            //
            //
          //}
      

		$(function() {

      
      if (homePageDisplayed == true) {
        displayHomePage();
        
      }

      $("#destination").focus(function(){
            $(".filter").hide();
            $(this).animate({width:"560"}, 200);
          
        });

      $("#destination").keyup(function(e) {
        console.log(e.which);
        var cursorKeys = [13, 37, 38, 39, 40];
        var dest = matches[0].value;

        if(jQuery.inArray(e.which, cursorKeys) === -1) {
          

          if (homePageDisplayed == true) {
            displayResultsScreen(dest);
          }  else {
           
            handleResults(dest);
          }
          
          
        } else if(e.which == 13) {
            console.log($("#destination").val());
            $(".tt-dropdown-menu").hide();
            handleResults($("#destination").val());
        }
      }); 

      function onCursorChanged($e, obj, datum) {
          handleResults(obj.value);
      }

			

			$('.typeahead').typeahead({
  				hint: true,
  				minLength: 1,
  				items: 5

			},
			{
  				name: 'destinations',
  				displayKey: 'value',
  				source: substringMatcher(destinations)
			}).on('typeahead:selected', onSelected).on('typeahead:cursorchanged', onCursorChanged);

      function onSelected($e, obj, datum) {
        //console.log('selected');
        var city = obj.value;
        var result = $.grep(cities, function(e){
          return e.city == city
        });

        //console.log (r);
        var NA = new google.maps.LatLng(result[0].lon, result[0].lat);
        map.panTo(NA);

        if ($("#srl").is(':visible')){
              $("#srl").fadeOut("100", function(){
                $("#srl").fadeIn("100");
              });

            } else {
              $("#srl").fadeIn("100");
            }

            $("#map_wrapper").show();

            displaySearchInstruction(false);
            displayFilters(true);

        //var result = $.grep(myArray, function(e){ return e.id == id; });

      }

      

		})
		</script>


		<style type="text/css">
			body {font-family: arial; margin:50px 100px;}
      #hotels {position:absolute; top: 60px; left:55px; bottom:0; width:425px; background-color: #fff; overflow-y:scroll;}
			
		</style>

	</head>
	<body>

    <style type="text/css">
      #srl {padding:0; margin:15px; list-style-type: none;}
      #srl li {padding-left:110px; background-repeat: no-repeat; background-position: -70px 0; margin-bottom:20px;}
      #srl li span.wr {font-size: 12px; color:#666;}
      #srl li div.value {overflow:hidden; margin-top:5px;}
      #srl li div.price {color:#D41200; font-size:32px; float:left; margin-right:10px;}
      #srl li div.message {float:left; font-size:12px; color:#999; padding-top:4px;}


      .results {position:absolute; top:0; left:55px; right:0; height:60px; background-color:#f1f1f1;}
      .home {position:absolute;top: 0; left: 0px; right:0; height:260px; background-color:#f1f1f1; text-align:center; padding-top:160px;}
      #search ul.searchhome {}
      ul.searchform {margin:0; padding:0; list-style-type: none;}
            ul.searchform li {display:inline-block; vertical-align:top; margin-right:20px; padding:0;}
            ul.searchform li.date, ul.searchform li.people {padding:10px 0 10px 30px;  background-repeat: no-repeat; background-position: 0 5px;}
            ul.searchform li.filter {padding:10px;}
            span.stars {font-size:13px;}
    </style>

    <div id="navigation" style="position:absolute; top:0; left:0; bottom:0; width:55px; background-color:#333;">
      <img src="i/icons.png" style="margin-top:10px"/>
    </div>

    <div id="hotels">
      <ul id="srl">
            <li style="background-image:url('http://media.expedia.com/hotels/1000000/30000/23700/23677/23677_131_e.jpg')">
              <span class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span><br />
              <a href="#" class="name">Grand Hyatt New York</a><br />
              <span class="wr"> Collect  welcome rewards nights</span>
              <div class="value">
                <div class="price">
                  $125
                </div>
                <div class="message">For 1 night<br /> including taxes and fees</div>
              </div>
            </li>
            <li style="background-image: url('http://exp.cdn-hotels.com/hotels/3000000/2250000/2244300/2244255/2244255_55_e.jpg')">
              <span class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span><br />
              <a href="#" class="name">Ace Hotel New York</a><br />
              <span class="wr"> Collect  welcome rewards nights</span>
              <div class="value">
                <div class="price">
                  $140
                </div>
                <div class="message">For 1 night<br /> including taxes and fees</div>
              </div>
            </li>
            <li style="background-image:url('http://exp.cdn-hotels.com/hotels/3000000/2450000/2442800/2442707/2442707_195_e.jpg')">
              <span class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span><br />
              <a href="#" class="name">Hotel Indigo NYC Chelsea</a><br />
              <span class="wr"> Collect  welcome rewards nights</span>
              <div class="value">
                <div class="price">
                  $276
                </div>
                <div class="message">For 1 night<br /> including taxes and fees</div>
              </div>
            </li>
            <li style="background-image:url('http://exp.cdn-hotels.com/hotels/1000000/910000/903500/903465/903465_180_e.jpg')">
              <span class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span><br />
              <a href="#" class="name">Eurostars Wall Street</a><br />
              <span class="wr"> Collect  welcome rewards nights</span>
              <div class="value">
                <div class="price">
                  $95
                </div>
                <div class="message">For 1 night<br /> including taxes and fees</div>
              </div>
            </li>
            <li style="background-image:url('http://exp.cdn-hotels.com/hotels/1000000/810000/801000/800989/800989_82_e.jpg')">
             <span class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span><br />
              <a href="#" class="name">Hotel Chandler</a><br />
              <span class="wr"> Collect  welcome rewards nights</span>
              <div class="value">
                <div class="price">
                  $145
                </div>
                <div class="message">For 1 night<br /> including taxes and fees</div>
              </div>
            </li>
            <li style="background-image:url('http://exp.cdn-hotels.com/hotels/1000000/50000/41900/41864/41864_172_e.jpg')">
              <span class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span><br />
              <a href="#" class="name">The Roosevelt Hotel New York</a><br />
              <span class="wr"> Collect  welcome rewards nights</span>
              <div class="value">
                <div class="price">
                  $109
                </div>
                <div class="message">For 1 night<br /> including taxes and fees</div>
              </div>
            </li>
          </ul>

    </div>

    <div id="map_wrapper" style=" position:absolute; top:60px; right:0; left:480px; bottom:0;">
       <div id="map_canvas" style="width:100%; height:100%;"></div>
    </div>

    <style type="text/css">
      .search_home {padding:10px 15px; background-color:#f1f1f1; width:820px; text-align:left; margin:0 auto;}
      .search_results {padding:10px 15px; background-color:#f1f1f1; width:auto; text-align:left; margin:0;}
    </style>

    <div id="search" class="results">
      <div id="strapline" style=" padding:0; width: 850px; margin:0 auto; text-align:left;">
            <h2 style="margin:50px 0 20px 0; padding:0 15px;">Branding and compelling strapline</h2>
            <div style="padding:15px 15px 0">
              <label style="display:block; font-size:18px;">Where are you going?</label>
            </div>
            
        </div>
      <div id="search_wrapper" class="">
        

        <ul  class="searchform">
            <li style="">
              <input id="destination" class="typeahead" placeholder="" autofocus style="border:0; border-bottom:solid 1px; outline:0;"/>
            </li>
            <li class="date" style="background-image:url('i/calendar_24.png');">Tonight</li>
            <li class="people" style="background-image:url('i/people_24.png');">2 Adults</li>
            <li class="filter" style="margin-left:10px;">Price</li>
            <li class="filter" >Star rating</li>
            <li class="filter" >Amenities</li>
            <li class="filter" >Location</li>
          </ul>
      </div>
        
    </div>
	

    <div id="searchinstruction" style="position:absolute; top:300px; left:105px; font-size: 13px; color:#666;display:none;">Press Enter to search</div>
    
   
	</body>
</html>